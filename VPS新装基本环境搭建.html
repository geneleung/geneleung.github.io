<!DOCTYPE html>
<html lang="zh_cn">
<head>
        <title>iknockdoor-VPS新装基本环境搭建</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" type="text/css" href="http://www.iknockdoor.com/theme/css/org.css" />
        <link rel="stylesheet" type="text/css" href="http://www.iknockdoor.com/theme/css/custom.css" />
        <link href="http://www.iknockdoor.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="iknockdoor Full Atom Feed" />

<meta name="description" content="VPS新装基本环境搭建，快速安装，使用方便，安全的VPS" />

<script>var _gaq=[['_setAccount','UA-103057848-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
        <!-- mathjax config similar to math.stackexchange -->
	<script type="text/x-mathjax-config">
	  MathJax.Hub.Config({
	  jax: ["input/TeX", "output/HTML-CSS"],
	  tex2jax: {
	  inlineMath: [ ['$', '$'] ],
	  displayMath: [ ['$$', '$$']],
	  processEscapes: true,
	  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
	  },
	  messageStyle: "none",
	  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
	  });
	</script>
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1>iknockdoor <strong></strong></h1>
        </header><!-- /#banner -->
        <nav id="menu"><ul>
        </ul></nav><!-- /#menu -->
        <nav class="sidebar">
	    <h5>分类</h5>
	    <ul>
	      <li ><a href="http://www.iknockdoor.com/category/du-shu.html">读书(2)</a></li>
	      <li ><a href="http://www.iknockdoor.com/category/jie-jue-fang-an.html">解决方案(1)</a></li>
	      <li class="active"><a href="http://www.iknockdoor.com/category/misc.html">misc(66)</a></li>
	      <li ><a href="http://www.iknockdoor.com/category/sheng-huo.html">生活(1)</a></li>
	    </ul>
	    <h5>标签</h5>
	    <ul>
	      <li><a href="http://www.iknockdoor.com/tag/adb.html">adb(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/android.html">Android(3)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/androidstudio.html">AndroidStudio(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/blog.html">blog(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/di-gui-lun.html">递归论(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/diao-shi.html">调试(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/emacs.html">emacs(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/english.html">english(2)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/gang-xing.html">港行(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/guo-xing.html">国行(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/org-blog.html">org-blog(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/pelican.html">pelican(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/recyclerview.html">RecyclerView(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/samsung-note9.html">samsung note9(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/sha1.html">sha1(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/shell.html">shell(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/shua-ji.html">刷机(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/terminal.html">terminal(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/termux.html">termux(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/vps.html">vps(1)</a></li>
	      <li><a href="http://www.iknockdoor.com/tag/zhong-wen.html">中文(1)</a></li>
	    </ul>

	    <h5>归档</h5>
	    <ul>
	      <li><a href="/posts/2019/05/index.html">五月 2019 (1)</a></li>
	      <li><a href="/posts/2019/04/index.html">四月 2019 (2)</a></li>
	      <li><a href="/posts/2019/03/index.html">三月 2019 (1)</a></li>
	      <li><a href="/posts/2018/12/index.html">十二月 2018 (6)</a></li>
	      <li><a href="/posts/2018/11/index.html">十一月 2018 (11)</a></li>
	      <li><a href="/posts/2018/10/index.html">十月 2018 (3)</a></li>
	      <li><a href="/posts/2018/09/index.html">九月 2018 (2)</a></li>
	      <li><a href="/posts/2018/07/index.html">七月 2018 (2)</a></li>
	      <li><a href="/posts/2018/06/index.html">六月 2018 (1)</a></li>
	      <li><a href="/posts/2018/05/index.html">五月 2018 (2)</a></li>
	      <li><a href="/posts/2018/04/index.html">四月 2018 (2)</a></li>
	      <li><a href="/posts/2018/03/index.html">三月 2018 (1)</a></li>
	      <li><a href="/posts/2018/02/index.html">二月 2018 (3)</a></li>
	      <li><a href="/posts/2018/01/index.html">一月 2018 (7)</a></li>
	      <li><a href="/posts/2017/12/index.html">十二月 2017 (17)</a></li>
	      <li><a href="/posts/2017/09/index.html">九月 2017 (1)</a></li>
	      <li><a href="/posts/2017/08/index.html">八月 2017 (1)</a></li>
	      <li><a href="/posts/2017/07/index.html">七月 2017 (7)</a></li>
	    </ul>
             <h5>Links</h5>
	    <ul>
	    </ul>
	    <h5>与我联系</h5>
	    <ul>
	      <li><a href="mailto:iknockdoor.com@gmail.com">E-mail</a></li>
	    </ul>
	</nav>
	    <!-- End Sidebar -->
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="http://www.iknockdoor.com/VPS新装基本环境搭建.html" rel="bookmark"
         title="Permalink to VPS新装基本环境搭建">VPS新装基本环境搭建</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2018-12-04T00:00:00+08:00">
      二 04 十二月 2018
    </time>
    <address class="vcard author">
      By           <a class="url fn" href="http://www.iknockdoor.com/author/chappie.html">chappie</a>
    </address>
    <div class="category">
        Category: <a href="http://www.iknockdoor.com/category/misc.html">misc</a>
    </div>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">install OS</h2>
<div class="outline-text-2" id="text-1">
<pre class="example">
centos-7-x86_64
</pre>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">验证服务器ssh指纹，避免中间人攻击</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">原理</h3>
<div class="outline-text-3" id="text-2-1">
<p>
服务器在安装openssh-server之后会生成各支持的加密算法的私钥和公钥，通常在下面的目录<sup><a id="fnr.1" name="fnr.1" class="footref" href="#fn.1">1</a></sup>下，pub的文件就是公钥文件了
</p>
<pre class="example">
/etc/ssh/
</pre>
<div class="org-src-container">

<pre class="src src-bash">   $ ls -1 /etc/ssh/ssh_host*
/etc/ssh/ssh_host_dsa_key
/etc/ssh/ssh_host_dsa_key.pub
/etc/ssh/ssh_host_ecdsa_key
/etc/ssh/ssh_host_ecdsa_key.pub
/etc/ssh/ssh_host_ed25519_key
/etc/ssh/ssh_host_ed25519_key.pub
/etc/ssh/ssh_host_rsa_key
/etc/ssh/ssh_host_rsa_key.pub
</pre>
</div>
<p>
当客户端ssh到服务器时会自动协商使用的加密算法，并拿到对应算法的服务器公钥，同时提示服务器公钥指纹，我们只需要比对指纹信息就可以确认服务器身份了。
</p>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">验证服务器公钥指纹</h3>
<div class="outline-text-3" id="text-2-2">
<p>
第一次ssh登陆服务器时会有如下提示(第一次是指~/.ssh/known_host文件中不包含此服务器)
</p>
<div class="org-src-container">

<pre class="src src-bash">  The authenticity of host '[xxx.xxx.xxx.xxx]:xxxx ([xxx.xxx.xxx.xxx]:xxxx)' can't be established.
ECDSA key fingerprint is SHA256:xxxxxxxxxxxxxxxxx
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '[xxx.xxx.xxx.xxx]:xxxx' (ECDSA) to the list of known hosts.
</pre>
</div>
<p>
如上可以知道服务器ssh采用的公钥的加密算法及公钥签名和公钥签名的格式，然后可以用可信的方式登陆服务器查看和比对服务器的公钥签名
</p>
<div class="org-src-container">

<pre class="src src-bash"># 获取指定服务器指定加密算法的公钥
ssh-keyscan -t ECDSA -p 22 127.0.0.1
# 以指定格式查看已知服务器的公钥指纹
ssh-keygen -E sha256 -lf ~/.ssh/known_hosts
# 在服务器上可以用下面这个命令查看自己的公钥指纹
ssh-keygen -E sha256 -lf /etc/ssh/ssh_host_ecdsa_key.pub
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">安装emacs</h2>
<div class="outline-text-2" id="text-3">
<p>
后面有比较多的文件编辑操作，这里还是很有必要先安装的。参考 <a href="%E5%AE%89%E8%A3%85emacs.html">安装emacs</a>
</p>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">添加新用户，并添加sudo权限</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">

<pre class="src src-bash">  # 添加xxx用户
  adduser xxx
  # 为xxx用户设置密码
  passwd xxx
  # 添加xxx用户到sudo用户中
  vim /etc/sudoers #或者用visudo命令
  ## Allow root to run any commands anywher  
root    ALL=(ALL)       ALL  
xxx     ALL=(ALL)       ALL  #这个是新增的用户
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">ssh安全配置<sup><a id="fnr.2" name="fnr.2" class="footref" href="#fn.2">2</a></sup></h2>
<div class="outline-text-2" id="text-5">
<p>
这里有篇文章挺好的: <a href="https://www.ibm.com/developerworks/cn/aix/library/au-sshsecurity/index.html">SSH安全性和配置入门</a> 根据实际情况采取以下配置
</p>
<ul class="org-ul">
<li>禁止root账户远程登陆
</li>
<li>仅使用SSH Protocol 2
</li>
<li>不支持闲置会话，并配置Idle Log Out Timeout间隔：似乎有点问题
</li>
<li>禁用基于主机的身份验证
</li>
<li>禁用用户的.rhosts文件
</li>
<li>禁用空密码
</li>
<li>保持ssh程序包和库为最新
</li>
<li>仅支持公钥登陆
</li>
<li>UsePAM no
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">ssh key 常见算法及安全性</h2>
<div class="outline-text-2" id="text-6">
<ul class="org-ul">
<li>DSA： 已被证明不安全，且从OpenSSH Server 7 之后便不再支持
</li>
<li>RSA： RSA算法产生的私钥的安全性依赖于密钥的长度，如果密钥的长度小于3072，则不够安全，比如常见的2048 位的ssh key 是不够安全的，1024
位直接被标记为不安全
</li>
<li>ECDSA：这个算法产生的密钥安全性依赖于当前机器产生的随机数的强度
</li>
<li>Ed25519： 目前最为推荐的ssh key 生成算法，安全性最好！<sup><a id="fnr.3" name="fnr.3" class="footref" href="#fn.3">3</a></sup>
</li>
</ul>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" name="fn.1" class="footnum" href="#fnr.1">1</a></sup> <p class="footpara">
<a href="http://www.jinbuguo.com/openssh/sshd.html">http://www.jinbuguo.com/openssh/sshd.html</a>
</p></div>

<div class="footdef"><sup><a id="fn.2" name="fn.2" class="footnum" href="#fnr.2">2</a></sup> <p class="footpara">
<a href="https://www.ibm.com/developerworks/cn/aix/library/au-sshsecurity/index.html">https://www.ibm.com/developerworks/cn/aix/library/au-sshsecurity/index.html</a>
</p></div>

<div class="footdef"><sup><a id="fn.3" name="fn.3" class="footnum" href="#fnr.3">3</a></sup> <p class="footpara">
<a href="https://www.freebuf.com/articles/system/185846.html">https://www.freebuf.com/articles/system/185846.html</a>
</p></div>


</div>
</div>
  </div><!-- /.entry-content -->
</section>
        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>