<!DOCTYPE html>
<html lang="zh_cn">
<head>
        <title>iknockdoor-Android style实战</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" type="text/css" href="http://www.iknockdoor.com/theme/css/org.css" />
        <link rel="stylesheet" type="text/css" href="http://www.iknockdoor.com/theme/css/custom.css" />
        <link href="http://www.iknockdoor.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="iknockdoor Full Atom Feed" />

    <meta name="tags" content="Android" />

<script>var _gaq=[['_setAccount','UA-103057848-1'],['_trackPageview']];(function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];g.src='//www.google-analytics.com/ga.js';s.parentNode.insertBefore(g,s)}(document,'script'))</script>
        <!-- mathjax config similar to math.stackexchange -->
	<script type="text/x-mathjax-config">
	  MathJax.Hub.Config({
	  jax: ["input/TeX", "output/HTML-CSS"],
	  tex2jax: {
	  inlineMath: [ ['$', '$'] ],
	  displayMath: [ ['$$', '$$']],
	  processEscapes: true,
	  skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
	  },
	  messageStyle: "none",
	  "HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
	  });
	</script>
</head>

<body id="index" class="home">
  <div id="banner"><div id="banner-inside">
      <nav id="menu">
      <header id="site_name">
                iknockdoor
        </header><!-- /#banner -->
          <ul>
            <li><a href="http://www.iknockdoor.com/index.html">Index</a></li>
            <li><a href="http://www.iknockdoor.com/categories.html">Categories</a></li>
            <li><a href="http://www.iknockdoor.com/tags.html">Tags</a></li>
            <li><a href="http://www.iknockdoor.com/archives.html">Archives</a></li>
      </ul></nav><!-- /#menu -->
  </div></div>
  <div id="content">
<section id="content" class="body">
  <header>
    <h2 class="entry-title">
      <a href="http://www.iknockdoor.com/Android style实战.html" rel="bookmark"
         title="Permalink to Android style实战">Android style实战</a></h2>
 
  </header>
  <footer class="post-info">
    <time class="published" datetime="2019-08-10T00:00:00+08:00">
      六 10 八月 2019
    </time>
  </footer><!-- /.post-info -->
  <div class="entry-content">
    <p>
之前有写过一个篇学习和分析Android attr,style,theme原理的<a href="Android%E7%9A%84attrs,style%E5%92%8Ctheme.html">blog</a>， 在实际应用中遇到时，尤其是一些系统空间，用起来和分析起来还是不是那么得心应手，这次就从系统控件EditText入手分析一下，看看Android的style到底怎么定义怎么生效怎么影响控件的。
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><a id="ID-1E409AD0-2B86-4BEA-B0AE-13E7F8966366" name="ID-1E409AD0-2B86-4BEA-B0AE-13E7F8966366"></a><span class="section-number-2">1</span> 系统默认的EditText&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ATTACH">ATTACH</span></span></h2>
<div class="outline-text-2" id="text-1">
<p>
这是一个Materail Design下的系统默认的全屏的EditText
</p>


<div class="figure">
<p><img src="data/1E/409AD0-2B86-4BEA-B0AE-13E7F8966366/sreencapture_2019-08-10_10-52-26.png" alt="sreencapture_2019-08-10_10-52-26.png" />
</p>
</div>

<p>
注意这里有几个明显的外观上的特点
</p>
<ol class="org-ol">
<li>红色的光标
</li>
<li>红色的下划线
</li>
<li>具有上下左右四边均有一定的边距，但是我们并没有设置padding
</li>
</ol>

<p>
布局文件如下：
</p>
<div class="org-src-container">

<pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-attribute-local-name">version</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">1.0</span><span class="org-nxml-attribute-value-delimiter">"</span> <span class="org-nxml-attribute-local-name">encoding</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">utf-8</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">androidx.constraintlayout.widget.ConstraintLayout</span>
        <span class="org-nxml-namespace-attribute-xmlns">xmlns</span><span class="org-nxml-namespace-attribute-colon">:</span><span class="org-nxml-namespace-attribute-prefix">android</span>=<span class="org-nxml-namespace-attribute-value-delimiter">"</span><span class="org-nxml-namespace-attribute-value">http://schemas.android.com/apk/res/android</span><span class="org-nxml-namespace-attribute-value-delimiter">"</span>
        <span class="org-nxml-namespace-attribute-xmlns">xmlns</span><span class="org-nxml-namespace-attribute-colon">:</span><span class="org-nxml-namespace-attribute-prefix">tools</span>=<span class="org-nxml-namespace-attribute-value-delimiter">"</span><span class="org-nxml-namespace-attribute-value">http://schemas.android.com/tools</span><span class="org-nxml-namespace-attribute-value-delimiter">"</span>
        <span class="org-nxml-namespace-attribute-xmlns">xmlns</span><span class="org-nxml-namespace-attribute-colon">:</span><span class="org-nxml-namespace-attribute-prefix">app</span>=<span class="org-nxml-namespace-attribute-value-delimiter">"</span><span class="org-nxml-namespace-attribute-value">http://schemas.android.com/apk/res-auto</span><span class="org-nxml-namespace-attribute-value-delimiter">"</span>
        <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">layout_width</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">match_parent</span><span class="org-nxml-attribute-value-delimiter">"</span>
        <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">layout_height</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">match_parent</span><span class="org-nxml-attribute-value-delimiter">"</span>
        <span class="org-nxml-attribute-prefix">tools</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">context</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">.MainActivity</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span>

    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">EditText</span>
            <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">id</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">@+id/edit_view</span><span class="org-nxml-attribute-value-delimiter">"</span>
            <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">layout_width</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">0dp</span><span class="org-nxml-attribute-value-delimiter">"</span>
            <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">layout_height</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">0dp</span><span class="org-nxml-attribute-value-delimiter">"</span>
            <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">gravity</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">start</span><span class="org-nxml-attribute-value-delimiter">"</span>
            <span class="org-nxml-attribute-prefix">app</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">layout_constraintBottom_toBottomOf</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">parent</span><span class="org-nxml-attribute-value-delimiter">"</span>
            <span class="org-nxml-attribute-prefix">app</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">layout_constraintLeft_toLeftOf</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">parent</span><span class="org-nxml-attribute-value-delimiter">"</span>
            <span class="org-nxml-attribute-prefix">app</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">layout_constraintRight_toRightOf</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">parent</span><span class="org-nxml-attribute-value-delimiter">"</span>
            <span class="org-nxml-attribute-prefix">app</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">layout_constraintTop_toTopOf</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">parent</span><span class="org-nxml-attribute-value-delimiter">"</span>
    <span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>

<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">androidx.constraintlayout.widget.ConstraintLayout</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>

<p>
光标是比较容易设置的，当时下划线和边距是从哪里来的？一开始我一直以为是
EditView控件自己绘制的，后来查资料想要去掉下划线时发现下划线是个
background的属性，那它是什么时候被设置的？在哪里被设置的？这个下划线是怎么实现的？下面来分析下划线和边距是如何被系统设置和生效的。
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Theme的声明</h2>
<div class="outline-text-2" id="text-2">
<p>
从Theme入手，我们的Theme定义如下：
</p>
<pre class="example">
&lt;style name="AppTheme" parent="Theme.AppCompat.Light.DarkActionBar"&gt;
</pre>
<p>
先看一下一个Theme需要定义哪些键值对，对Theme的声明见系统文件
attrs.xml，每个SDK包都有。
</p>
<div class="org-src-container">

<pre class="src src-xml"><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">resources</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-comment-delimiter">&lt;!--</span><span class="org-nxml-comment-content"> These are the standard attributes that make up a complete theme. </span><span class="org-nxml-comment-delimiter">--&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">declare-styleable</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">Theme</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-comment-delimiter">&lt;!--</span><span class="org-nxml-comment-content"> ============== </span><span class="org-nxml-comment-delimiter">--&gt;</span>
      <span class="org-nxml-comment-delimiter">&lt;!--</span><span class="org-nxml-comment-content"> Generic styles </span><span class="org-nxml-comment-delimiter">--&gt;</span>
      <span class="org-nxml-comment-delimiter">&lt;!--</span><span class="org-nxml-comment-content"> ============== </span><span class="org-nxml-comment-delimiter">--&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">eat-comment</span> <span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>

      <span class="org-nxml-comment-delimiter">&lt;!--</span><span class="org-nxml-comment-content"> Specifies that a theme has a light background with dark text on top.  </span><span class="org-nxml-comment-delimiter">--&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">attr</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">isLightTheme</span><span class="org-nxml-attribute-value-delimiter">"</span> <span class="org-nxml-attribute-local-name">format</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">boolean</span><span class="org-nxml-attribute-value-delimiter">"</span> <span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-text">      ...</span>
<span class="org-nxml-text">      </span><span class="org-nxml-comment-delimiter">&lt;!--</span><span class="org-nxml-comment-content"> Default EditText style. </span><span class="org-nxml-comment-delimiter">--&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">attr</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">editTextStyle</span><span class="org-nxml-attribute-value-delimiter">"</span> <span class="org-nxml-attribute-local-name">format</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">reference</span><span class="org-nxml-attribute-value-delimiter">"</span> <span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-text">      ...</span>
<span class="org-nxml-text">      </span><span class="org-nxml-comment-delimiter">&lt;!--</span><span class="org-nxml-comment-content"> EditText text foreground color. </span><span class="org-nxml-comment-delimiter">--&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">attr</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">editTextColor</span><span class="org-nxml-attribute-value-delimiter">"</span> <span class="org-nxml-attribute-local-name">format</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">reference|color</span><span class="org-nxml-attribute-value-delimiter">"</span> <span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-comment-delimiter">&lt;!--</span><span class="org-nxml-comment-content"> EditText background drawable. </span><span class="org-nxml-comment-delimiter">--&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">attr</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">editTextBackground</span><span class="org-nxml-attribute-value-delimiter">"</span> <span class="org-nxml-attribute-local-name">format</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">reference</span><span class="org-nxml-attribute-value-delimiter">"</span> <span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">declare-styleable</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-text">  ...</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">resources</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
<p>
这里可以看到一个Theme是可以定义EditStyle,background等属性的。
</p>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Theme的定义</h2>
<div class="outline-text-2" id="text-3">
<p>
在系统文件themes.xml定义系统Theme声明的各个字段的值。
</p>
<div class="org-src-container">

<pre class="src src-xml"><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">resources</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-comment-delimiter">&lt;!--</span><span class="org-nxml-comment-content"> The default theme for apps on API level 10 and lower. This is the theme used for</span>
<span class="org-nxml-comment-content">       activities that have not explicitly set their own theme.</span>
<span class="org-nxml-comment-content">       &lt;p&gt;You can count on this being a dark</span>
<span class="org-nxml-comment-content">       background with light text on top, but should try to make no</span>
<span class="org-nxml-comment-content">       other assumptions about its appearance. In particular, the text</span>
<span class="org-nxml-comment-content">       inside of widgets using this theme may be completely different,</span>
<span class="org-nxml-comment-content">       with the widget container being a light color and the text on top</span>
<span class="org-nxml-comment-content">       of it a dark color.</span>
<span class="org-nxml-comment-content">       &lt;p&gt;If you're developing for API level 11 and higher, you should instead use {@link</span>
<span class="org-nxml-comment-content">       #Theme_Holo} or {@link #Theme_DeviceDefault}.&lt;/p&gt;</span>
<span class="org-nxml-comment-content">  </span><span class="org-nxml-comment-delimiter">--&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">style</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">Theme</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">isLightTheme</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">false</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-text">      ...</span>
<span class="org-nxml-text">      </span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">editTextStyle</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">@style/Widget.EditText</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-text">      ...</span>
<span class="org-nxml-text">      </span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">editTextBackground</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">@drawable/edit_text</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">style</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-text">  ...</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">rescources</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
<p>
这里可以看到，editTextStyle定义的值是一个引用指向到Widget.EditText，
Theme.AppCompat.Light.DarkActionBar Theme实际编译出来的editTextStyle
和editTextBackground定义的值和上面不一样，但是我没有找到
Theme.AppCompat.Light.DarkActionBar主题的定义文件，可能在support包中，不过并不影响理解，和上面最基本的Theme的定义方式是一样的。
Theme.AppCompat.Light.DarkActionBar主题具体的值如下：
</p>
<div class="org-src-container">

<pre class="src src-xml"><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">editTextStyle</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">@style/Widget.AppCompat.EditText</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">editTextBackground</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">@drawable/abc_edit_text_material</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">editTextColor</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">?android:attr/textColorPrimary</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
<p>
已经很接近了。
Widget.AppCompat.EditText样式的定义在文件styles<sub>material</sub>.xml文件中
</p>
<pre class="example">
&lt;style name="Widget.Material.EditText" parent="Widget.EditText"/&gt;
</pre>
<p>
最终Widget.EditText的定义在系统的styles.xml文件中
</p>
<div class="org-src-container">

<pre class="src src-xml"><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">style</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">Widget.EditText</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">focusable</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">true</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">focusableInTouchMode</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">true</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">clickable</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">true</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">background</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">?attr/editTextBackground</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">textAppearance</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">?attr/textAppearanceMediumInverse</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">textColor</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">?attr/editTextColor</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">gravity</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">center_vertical</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">breakStrategy</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">simple</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">hyphenationFrequency</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">normal</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">defaultFocusHighlightEnabled</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">false</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">item</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">style</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
<p>
而EditText的声明也是在attrs.xml文件中，具体比较长就不贴了，没搞明白包名怎么给的，就是widget。*重点是到这里，就跟自定义view用到的字段开始一一对应了，*看上面的EditText style的定义，都是EditText的属性，这里可以看到background的值是一个样式属性attr/editTextBackground，而这个值在前面给了，就是@drawable/abc<sub>edit</sub><sub>text</sub><sub>material</sub>
</p>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> EditText的background</h2>
<div class="outline-text-2" id="text-4">
<p>
我们再看一下drawable/abc<sub>edit</sub><sub>text</sub><sub>material</sub>
</p>
<div class="org-src-container">

<pre class="src src-xml">  <span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" encoding="utf-8"</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
<span class="org-nxml-comment-delimiter">&lt;!--</span><span class="org-nxml-comment-content"> Copyright (C) 2014 The Android Open Source Project</span>

<span class="org-nxml-comment-content">     Licensed under the Apache License, Version 2.0 (the "License");</span>
<span class="org-nxml-comment-content">     you may not use this file except in compliance with the License.</span>
<span class="org-nxml-comment-content">     You may obtain a copy of the License at</span>

<span class="org-nxml-comment-content">          http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="org-nxml-comment-content">     Unless required by applicable law or agreed to in writing, software</span>
<span class="org-nxml-comment-content">     distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="org-nxml-comment-content">     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="org-nxml-comment-content">     See the License for the specific language governing permissions and</span>
<span class="org-nxml-comment-content">     limitations under the License.</span>
<span class="org-nxml-comment-delimiter">--&gt;</span>

<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">inset</span> <span class="org-nxml-namespace-attribute-xmlns">xmlns</span><span class="org-nxml-namespace-attribute-colon">:</span><span class="org-nxml-namespace-attribute-prefix">android</span>=<span class="org-nxml-namespace-attribute-value-delimiter">"</span><span class="org-nxml-namespace-attribute-value">http://schemas.android.com/apk/res/android</span><span class="org-nxml-namespace-attribute-value-delimiter">"</span>
       <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">insetLeft</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">@dimen/abc_edit_text_inset_horizontal_material</span><span class="org-nxml-attribute-value-delimiter">"</span>
       <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">insetRight</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">@dimen/abc_edit_text_inset_horizontal_material</span><span class="org-nxml-attribute-value-delimiter">"</span>
       <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">insetTop</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">@dimen/abc_edit_text_inset_top_material</span><span class="org-nxml-attribute-value-delimiter">"</span>
       <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">insetBottom</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">@dimen/abc_edit_text_inset_bottom_material</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-delimiter">&gt;</span>

    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">selector</span><span class="org-nxml-tag-delimiter">&gt;</span>
        <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">state_enabled</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">false</span><span class="org-nxml-attribute-value-delimiter">"</span> <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">drawable</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">@drawable/abc_textfield_default_mtrl_alpha</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>
        <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">state_pressed</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">false</span><span class="org-nxml-attribute-value-delimiter">"</span> <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">state_focused</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">false</span><span class="org-nxml-attribute-value-delimiter">"</span> <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">drawable</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">@drawable/abc_textfield_default_mtrl_alpha</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>
        <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">item</span> <span class="org-nxml-attribute-prefix">android</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">drawable</span>=<span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-attribute-value">@drawable/abc_textfield_activated_mtrl_alpha</span><span class="org-nxml-attribute-value-delimiter">"</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">selector</span><span class="org-nxml-tag-delimiter">&gt;</span>

<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">inset</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
<p>
终于看到了边距和下划线。inset的官方文档见<a href="https://developer.android.com/reference/android/graphics/drawable/InsetDrawable">这里</a>
</p>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Theme和Style中定义的属性值如何在view中使用</h2>
<div class="outline-text-2" id="text-5">
<p>
看一下Attributeset和TypedArray已经R.styleable.*的源码即可
</p>
</div>
</div>
<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> 总结</h2>
<div class="outline-text-2" id="text-6">
<p>
从上面整个过程可以看出，搞明白了EditText的样式设置过程基本上也就搞明白了Theme和style
</p>
<ol class="org-ol">
<li>attrs.xml中声明了Theme和它需要定义的属性，这些属性都是自定义的，跟Android控件没有任何关系
</li>
<li>themes.xml中定义了指定Theme中各个属性的值，这个值可以是个具体的值也可以是个引用，对于editTextStyle它的值指向了一个style
</li>
<li>Widget.EditText这个style就跟EditText控件有关系了，具体的值又可以引用样式属性
</li>
<li>最终background的值定义到了一个drawable
</li>
<li>包括EditText是如何取到这个值的
</li>
</ol>
</div>
</div>

  </div><!-- /.entry-content -->
  <footer class="post-info-footer">
        Category: <a href="http://www.iknockdoor.com/category/kai-fa.html"><span>开发</span></a>
    
        Tags:
            <a href="http://www.iknockdoor.com/tag/android.html"><span>Android</span></a>
    
  </footer>
</section>
        </div>
        <footer id="contentinfo" class="body">
          © 2017-2020 iknockdoor</address><!-- /#about -->
        </footer><!-- /#contentinfo -->
</body>
</html>