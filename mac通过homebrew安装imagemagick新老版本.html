<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>mac通过homebrew安装imagemagick新老版本</title>
<!--  -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta name='viewport' content='width=device-width,initial-scale=1'><link rel='stylesheet' href='/res/code.css' /><link rel='stylesheet' href='/res/solarized-light.min.css' />
</head>
<body>
<div id="org-div-home-and-up">
 <a accesskey="h" href="http://www.iknockdoor.com/"> UP </a>
|
 <a accesskey="H" href="http://www.iknockdoor.com/"> HOME </a>
|
<a accesskey="H" href=""> RSS </a>
</div><div id="content">
<h1 class="title">mac通过homebrew安装imagemagick新老版本</h1>
<p>
emacs支持显示嵌入式的显示图片并能够调整图片大小需要在编译期间指定
imagemagick的支持，但emacs 25.3的编译只能够识别imagemagick的6.x版本，
无法识别7.x版本，使用brew在mac系统上安装imagemagic的老版本算是比较方便
了，下面是安装方法。
</p>


<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">版本信息</h2>
<div class="outline-text-2" id="text-1">
<p>
Mac OS X 10.12.6 (16G29) Sierra
Emacs 25.3
</p>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">安装command line tool</h2>
<div class="outline-text-2" id="text-2">
<pre class="example">
xcode-select --install
</pre>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">安装brew</h2>
<div class="outline-text-2" id="text-3">
<pre class="example">
/usr/bin/ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)"
</pre>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><a id="ID-B0BEE131-FC9B-4506-BB02-6AE1BFC5E2F5" name="ID-B0BEE131-FC9B-4506-BB02-6AE1BFC5E2F5"></a>安装imagemagick 6.9.7-10&#xa0;&#xa0;&#xa0;<span class="tag"><span class="ATTACH">ATTACH</span></span></h2>
<div class="outline-text-2" id="text-4">
<p>
原地址在<a href="https://gist.github.com/leesheppard/69a283ee4af484e2029809a0f5e09932">这里</a> ，brew的安装脚本如下，brew在安装时会去imagemagick的官网
上下载源文件并交验hash值，为了避免对应版本下线，我把源文件做了备份。
<a href="data/B0/BEE131-FC9B-4506-BB02-6AE1BFC5E2F5/ImageMagick-6.9.7-10.tar.xz">ImageMagick-6.9.7-10.tar.xz</a>
</p>
<pre class="example">
brew install https://gist.githubusercontent.com/leesheppard/69a283ee4af484e2029809a0f5e09932/raw/88bc116b515a456a2e1bad476b6124d28ce2f6f6/imagemagick.rb
brew pin imagemagick # 避免被版本被升级，可以固定这个版本
</pre>

<div class="org-src-container">

<pre class="src src-ruby"><span class="org-builtin">require</span> <span class="org-string">'formula'</span>

<span class="org-keyword">class</span> <span class="org-type">Imagemagick</span> &lt; <span class="org-type">Formula</span>
  homepage <span class="org-string">'http://www.imagemagick.org'</span>

  url <span class="org-string">'http://www.imagemagick.org/download/releases/ImageMagick-6.9.7-10.tar.xz'</span>
  sha256 <span class="org-string">'0bfb2e3459b739669845c20ee1b6014a1a3c429fb0cb9777a8b65cd5c3effb09'</span>

  head <span class="org-string">'https://www.imagemagick.org/subversion/ImageMagick/trunk'</span>,
    <span class="org-constant">:using</span> =&gt; <span class="org-type">UnsafeSubversionDownloadStrategy</span>

  option <span class="org-string">'with-quantum-depth-8'</span>, <span class="org-string">'Compile with a quantum depth of 8 bit'</span>
  option <span class="org-string">'with-quantum-depth-16'</span>, <span class="org-string">'Compile with a quantum depth of 16 bit'</span>
  option <span class="org-string">'with-quantum-depth-32'</span>, <span class="org-string">'Compile with a quantum depth of 32 bit'</span>
  option <span class="org-string">'with-perl'</span>, <span class="org-string">'enable build/install of PerlMagick'</span>
  option <span class="org-string">'without-magick-plus-plus'</span>, <span class="org-string">'disable build/install of Magick++'</span>

  depends_on <span class="org-string">"libtool"</span> =&gt; <span class="org-constant">:run</span>

  depends_on <span class="org-string">'pkg-config'</span> =&gt; <span class="org-constant">:build</span>

  depends_on <span class="org-string">'jpeg'</span> =&gt; <span class="org-constant">:recommended</span>
  depends_on <span class="org-string">'libpng'</span> =&gt; <span class="org-constant">:recommended</span>
  depends_on <span class="org-string">'freetype'</span> =&gt; <span class="org-constant">:recommended</span>

  depends_on <span class="org-constant">:x11</span> =&gt; <span class="org-constant">:optional</span>
  depends_on <span class="org-string">'fontconfig'</span> =&gt; <span class="org-constant">:optional</span>
  depends_on <span class="org-string">'libtiff'</span> =&gt; <span class="org-constant">:optional</span>
  depends_on <span class="org-string">'little-cms'</span> =&gt; <span class="org-constant">:optional</span>
  depends_on <span class="org-string">'little-cms2'</span> =&gt; <span class="org-constant">:optional</span>
  depends_on <span class="org-string">'jasper'</span> =&gt; <span class="org-constant">:optional</span>
  depends_on <span class="org-string">'libwmf'</span> =&gt; <span class="org-constant">:optional</span>
  depends_on <span class="org-string">'librsvg'</span> =&gt; <span class="org-constant">:optional</span>
  depends_on <span class="org-string">'liblqr'</span> =&gt; <span class="org-constant">:optional</span>
  depends_on <span class="org-string">'openexr'</span> =&gt; <span class="org-constant">:optional</span>
  depends_on <span class="org-string">'ghostscript'</span> =&gt; <span class="org-constant">:optional</span>
  depends_on <span class="org-string">'webp'</span> =&gt; <span class="org-constant">:optional</span>

  opoo <span class="org-string">'--with-ghostscript is not recommended'</span> <span class="org-keyword">if</span> build.with? <span class="org-string">'ghostscript'</span>

  skip_clean <span class="org-constant">:la</span>

  <span class="org-keyword">def</span> <span class="org-function-name">install</span>
    args = [ <span class="org-string">"--disable-osx-universal-binary"</span>,
             <span class="org-string">"--prefix=</span><span class="org-variable-name">#{prefix}</span><span class="org-string">"</span>,
             <span class="org-string">"--disable-dependency-tracking"</span>,
             <span class="org-string">"--enable-shared"</span>,
             <span class="org-string">"--disable-static"</span>,
             <span class="org-string">"--without-pango"</span>,
             <span class="org-string">"--with-modules"</span>,
             <span class="org-string">"--disable-openmp"</span>]

    args &lt;&lt; <span class="org-string">"--disable-opencl"</span> <span class="org-keyword">if</span> build.include? <span class="org-string">'disable-opencl'</span>
    args &lt;&lt; <span class="org-string">"--without-gslib"</span> <span class="org-keyword">if</span> build.without? <span class="org-string">'ghostscript'</span>
    args &lt;&lt; <span class="org-string">"--without-perl"</span> <span class="org-keyword">if</span> build.without? <span class="org-string">'perl'</span>
    args &lt;&lt; <span class="org-string">"--with-gs-font-dir=</span><span class="org-variable-name">#{HOMEBREW_PREFIX}</span><span class="org-string">/share/ghostscript/fonts"</span> <span class="org-keyword">if</span> build.without? <span class="org-string">'ghostscript'</span>
    args &lt;&lt; <span class="org-string">"--without-magick-plus-plus"</span> <span class="org-keyword">if</span> build.without? <span class="org-string">'magick-plus-plus'</span>
    args &lt;&lt; <span class="org-string">"--enable-hdri=yes"</span> <span class="org-keyword">if</span> build.include? <span class="org-string">'enable-hdri'</span>

    <span class="org-keyword">if</span> build.with? <span class="org-string">'quantum-depth-32'</span>
      quantum_depth = 32
    <span class="org-keyword">elsif</span> build.with? <span class="org-string">'quantum-depth-16'</span>
      quantum_depth = 16
    <span class="org-keyword">elsif</span> build.with? <span class="org-string">'quantum-depth-8'</span>
      quantum_depth = 8
    <span class="org-keyword">end</span>

    args &lt;&lt; <span class="org-string">"--with-quantum-depth=</span><span class="org-variable-name">#{quantum_depth}</span><span class="org-string">"</span> <span class="org-keyword">if</span> quantum_depth
    args &lt;&lt; <span class="org-string">"--with-rsvg"</span> <span class="org-keyword">if</span> build.with? <span class="org-string">'librsvg'</span>
    args &lt;&lt; <span class="org-string">"--without-x"</span> <span class="org-keyword">if</span> build.without? <span class="org-string">'x11'</span>
    args &lt;&lt; <span class="org-string">"--with-fontconfig=yes"</span> <span class="org-keyword">if</span> build.with? <span class="org-string">'fontconfig'</span>
    args &lt;&lt; <span class="org-string">"--with-freetype=yes"</span> <span class="org-keyword">if</span> build.with? <span class="org-string">'freetype'</span>
    args &lt;&lt; <span class="org-string">"--with-webp=yes"</span> <span class="org-keyword">if</span> build.include? <span class="org-string">'webp'</span>

    <span class="org-comment-delimiter"># </span><span class="org-comment">versioned stuff in main tree is pointless for us</span>
    inreplace <span class="org-string">'configure'</span>, <span class="org-string">'${PACKAGE_NAME}-${PACKAGE_VERSION}'</span>, <span class="org-string">'${PACKAGE_NAME}'</span>
    <span class="org-builtin">system</span> <span class="org-string">"./configure"</span>, *args
    <span class="org-builtin">system</span> <span class="org-string">"make install"</span>
  <span class="org-keyword">end</span>

  <span class="org-keyword">def</span> <span class="org-function-name">caveats</span>
    s = <span class="org-string">&lt;&lt;-EOS</span>.undent
<span class="org-string">      For full Perl support you must install the Image::Magick module from the CPAN.</span>
<span class="org-string">        https://metacpan.org/module/Image::Magick</span>

<span class="org-string">      The version of the Perl module and ImageMagick itself need to be kept in sync.</span>
<span class="org-string">      If you upgrade one, you must upgrade the other.</span>

<span class="org-string">      For this version of ImageMagick you should install</span>
<span class="org-string">      version </span><span class="org-variable-name">#{version}</span><span class="org-string"> of the Image::Magick Perl module.</span>
<span class="org-string">    EOS</span>
    s <span class="org-keyword">if</span> build.with? <span class="org-string">'perl'</span>
  <span class="org-keyword">end</span>

  test <span class="org-keyword">do</span>
    <span class="org-builtin">system</span> <span class="org-string">"</span><span class="org-variable-name">#{bin}</span><span class="org-string">/identify"</span>, <span class="org-string">"/usr/share/doc/cups/images/cups.png"</span>
  <span class="org-keyword">end</span>
<span class="org-keyword">end</span>
</pre>
</div>
<p>
如果要支持PDF转image，还需安装依赖库gs
</p>
<pre class="example">
brew install ghostscript
</pre>
</div>
</div>
</div>
<div id="postamble" class="status">
<hr />
<p>By Chappie 
<a href="https://www.gnu.org/software/emacs/">emacs 25.3.1</a>
<a href="https://orgmode.org/">org mode 8.2.10</a></p>
<script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-103057848-1', 'auto');
        ga('send', 'pageview');
</script>
</div>
</body>
</html>
